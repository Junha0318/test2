<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ì£¼ í‰ë²”í•œ ë¬¼ë†€ì´ ì‚¬ê³  ì˜ˆë°© ë°©íƒˆì¶œ</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Noto Sans KR', sans-serif; }
        html, body { width: 100%; height: 100%; overflow: hidden; }
        #game-container { width: 100%; height: 100%; position: relative; }
        .room { position: relative; width: 100%; height: 100%; background-size: cover; background-position: center; position: absolute; top: 0; left: 0; display: none; opacity: 0; transition: opacity 0.5s ease-in-out; }
        .room.active { display: block; opacity: 1; }
        #room1 { background-image: url('https://github.com/Junha0318/tetetest123/blob/main/Whisk_864e6ac5f1.jpg?raw=true'); }
        #room2 { background-image: url('https://github.com/Junha0318/tetetest123/blob/main/Whisk_da02bf157b.jpg?raw=true'); }
        #room3 { background-image: url('https://github.com/Junha0318/tetetest123/blob/main/Whisk_c144633e1c.jpg?raw=true'); }
        .clickable-object { position: absolute; cursor: pointer; border-radius: 15px; transition: background-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out; }
        .clickable-object:hover { background-color: rgba(0, 191, 255, 0.25); box-shadow: 0 0 15px 5px rgba(0, 191, 255, 0.5); }
        #object1-1 { top: 40%; left: 35%; width: 30%; height: 45%; } #object1-2 { top: 0; left: 10%; width: 80%; height: 25%; } #object1-3 { top: 70%; left: 65%; width: 20%; height: 20%; }
        #object2-1 { top: 25%; left: 5%; width: 45%; height: 65%; } #object2-2 { top: 45%; left: 55%; width: 15%; height: 20%; } #object2-3 { top: 15%; left: 70%; width: 25%; height: 30%; }
        #object3-1 { top: 60%; left: 10%; width: 30%; height: 35%; } #object3-2 { top: 25%; left: 42%; width: 16%; height: 15%; } #object3-3 { top: 30%; left: 65%; width: 30%; height: 50%; }
        .modal { display: none; position: fixed; z-index: 50; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
        .modal-content { background-color: #fdfdfd; padding: 30px; border-radius: 10px; width: 90%; max-width: 500px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .modal-content p { margin-bottom: 15px; font-size: 22px; line-height: 1.5; }
        .modal-content .modal-title { font-size: 28px; font-weight: bold; color: #333; }
        .modal-content input { width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 5px; font-size: 20px; }
        .modal-content button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 22px; margin: 5px; }
        .btn-confirm { background-color: #007bff; color: white; } .btn-close { background-color: #6c757d; color: white; } .btn-restart { background-color: #28a745; color: white; }
        .result-message { margin-top: 20px; font-weight: bold; min-height: 25px; font-size: 22px !important; }
        #timer-display { position: fixed; top: 20px; right: 20px; font-size: 1.8em; font-family: 'Courier New', Courier, monospace; color: white; background-color: rgba(0, 0, 0, 0.6); padding: 10px 20px; border-radius: 10px; z-index: 20; }
        #hint-display { position: fixed; bottom: 20px; left: 20px; font-size: 1.5em; color: white; background-color: rgba(0, 0, 0, 0.6); padding: 10px 20px; border-radius: 10px; z-index: 20; }
        #stage-display { position: fixed; top: 85px; right: 20px; font-size: 1.2em; font-family: 'Noto Sans KR', sans-serif; color: white; background-color: rgba(0, 0, 0, 0.6); padding: 5px 15px; border-radius: 8px; z-index: 20; }
        #title-screen-modal { display: flex; z-index: 100; }
        #name-input-modal, #timer-display, #hint-display, #stage-display { display: none; }
        #game-title { font-size: 3em; margin-bottom: 40px; color: #222; font-weight: bold; }
        #door-open-message { font-size: 2em; font-weight: bold; color: #007bff; }
    </style>
</head>
<body>
    
    <div id="title-screen-modal" class="modal"><div class="modal-content"><h1 id="game-title">ì•„ì£¼ í‰ë²”í•œ ë¬¼ë†€ì´<br>ì‚¬ê³  ì˜ˆë°© ë°©íƒˆì¶œ</h1><button id="show-name-input-btn" class="btn-confirm">ì‹œì‘í•˜ê¸°</button></div></div>
    <div id="name-input-modal" class="modal"><div class="modal-content"><p class="modal-title">ì•ˆì „í•œ ë¬¼ë†€ì´ë¥¼ ìœ„í•´!</p><p>ë‹¹ì‹ ì˜ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p><input type="text" id="player-name-input" placeholder="ì´ë¦„" maxlength="10"><button id="submit-name-btn" class="btn-confirm">í™•ì¸</button></div></div>
    <div id="welcome-message-modal" class="modal"><div class="modal-content"><p id="welcome-message-text" class="modal-title"></p><button id="start-game-btn" class="btn-confirm">ë„¤, ì¢‹ì•„ìš”!</button></div></div>
    <div id="door-open-modal" class="modal"><div class="modal-content"><p id="door-open-message">ë¬¸ì´ ì—´ë ¸ë‹¤!ğŸ˜†</p></div></div>

    <div id="timer-display">00:00</div>
    <div id="hint-display"></div>
    <div id="stage-display">ìŠ¤í…Œì´ì§€ 1</div>

    <div id="game-container">
        <div id="room1" class="room active"><div class="clickable-object" id="object1-1" data-room="1" data-object="1"></div><div class="clickable-object" id="object1-2" data-room="1" data-object="2"></div><div class="clickable-object" id="object1-3" data-room="1" data-object="3"></div></div>
        <div id="room2" class="room"><div class="clickable-object" id="object2-1" data-room="2" data-object="1"></div><div class="clickable-object" id="object2-2" data-room="2" data-object="2"></div><div class="clickable-object" id="object2-3" data-room="2" data-object="3"></div></div>
        <div id="room3" class="room"><div class="clickable-object" id="object3-1" data-room="3" data-object="1"></div><div class="clickable-object" id="object3-2" data-room="3" data-object="2"></div><div class="clickable-object" id="object3-3" data-room="3" data-object="3"></div></div>
    </div>
    <div id="quiz-modal" class="modal"><div class="modal-content"><p id="quiz-question"></p><input type="text" id="quiz-answer" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”"><button id="submit-answer" class="btn-confirm">ì •ë‹µ í™•ì¸</button><p id="quiz-result" class="result-message"></p><button id="close-quiz-modal" class="btn-close">ë‹«ê¸°</button></div></div>
    <div id="password-modal" class="modal"><div class="modal-content"><p id="password-title" class="modal-title">ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p><p>ëª¨ë“  ì¡°ê°ì„ ìˆœì„œëŒ€ë¡œ ì¡°í•©í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš”.</p><input type="text" id="password-input" placeholder="ë¹„ë°€ë²ˆí˜¸"><button id="submit-password" class="btn-confirm">ë¬¸ ì—´ê¸°</button><p id="password-result" class="result-message"></p></div></div>
    <div id="game-clear-modal" class="modal"><div class="modal-content"><p class="modal-title"><span id="player-name-display"></span>ë‹˜, ğŸ‰ íƒˆì¶œ ì„±ê³µ! ğŸ‰</p><p id="escape-rank" class="result-message"></p><p id="final-time" class="result-message"></p><button id="restart-game" class="btn-restart">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button></div></div>

    <script>
        // --- DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ---
        const quizModal = document.getElementById('quiz-modal'), questionEl = document.getElementById('quiz-question'), answerEl = document.getElementById('quiz-answer'), submitAnswerBtn = document.getElementById('submit-answer'), quizResultEl = document.getElementById('quiz-result'), closeQuizBtn = document.getElementById('close-quiz-modal'), passwordModal = document.getElementById('password-modal'), passwordTitleEl = document.getElementById('password-title'), passwordInputEl = document.getElementById('password-input'), submitPasswordBtn = document.getElementById('submit-password'), passwordResultEl = document.getElementById('password-result'), gameClearModal = document.getElementById('game-clear-modal'), restartGameBtn = document.getElementById('restart-game'), clickableObjects = document.querySelectorAll('.clickable-object');
        const timerDisplayEl = document.getElementById('timer-display'), finalTimeEl = document.getElementById('final-time'), hintDisplayEl = document.getElementById('hint-display'), stageDisplayEl = document.getElementById('stage-display');
        const nameInputModal = document.getElementById('name-input-modal'), playerNameInputEl = document.getElementById('player-name-input'), submitNameBtn = document.getElementById('submit-name-btn'), playerNameDisplayEl = document.getElementById('player-name-display');
        const welcomeMessageModal = document.getElementById('welcome-message-modal'), welcomeMessageTextEl = document.getElementById('welcome-message-text'), startGameBtn = document.getElementById('start-game-btn');
        const titleScreenModal = document.getElementById('title-screen-modal'), showNameInputBtn = document.getElementById('show-name-input-btn');
        const escapeRankEl = document.getElementById('escape-rank'), doorOpenModal = document.getElementById('door-open-modal');

        // --- ë°ì´í„° ì •ì˜ ---
        const quizzes = {
            '1': { '1': { question: "ë¬¼ë†€ì´ë¥¼ í•˜ê¸° ì „, ë¨¼ì € í•´ì•¼ í•  ê²ƒì€?", answer: "ì¤€ë¹„ìš´ë™", secretNumber: '7', solved: false }, '2': { question: "ìœ„ê¸‰ ìƒí™©ì¼ë•ŒëŠ” ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?", answer: "ë„ì›€ì„ ìš”ì²­í•œë‹¤", secretNumber: '1', solved: false }, '3': { question: "ë¬¼ì— ë¹ ì§„ ì‚¬ëŒì„ ë°œê²¬í–ˆì„ë•Œ, í•´ì•¼í•  í–‰ë™ì€?", answer: "119ì— ì‹ ê³ í•œë‹¤", secretNumber: '4', solved: false } },
            '2': { '1': { question: "ì´ê³³ì€ ì˜·ì„ ê°ˆì•„ì…ëŠ” ê³³ì…ë‹ˆë‹¤. ë¬´ì—‡ì´ë¼ê³  ë¶€ë¥¼ê¹Œìš”?", answer: "íƒˆì˜ì‹¤", secretNumber: '2', solved: false }, '2': { question: "ë²½ì— ë¶™ì–´ìˆëŠ” ì¢…ì´ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ì•ˆë‚´ë¬¸", secretNumber: '9', solved: false }, '3': { question: "ë°–ì„ ë³¼ ìˆ˜ ìˆëŠ” ì´ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ì°½ë¬¸", secretNumber: '5', solved: false } },
            '3': { 
                '1': { question: "í¸íˆ ì•‰ì•„ ì‰´ ìˆ˜ ìˆëŠ” ì´ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ì˜ì", secretNumber: '8', solved: false }, 
                '2': { question: "ë‚˜ê°€ë ¤ë©´ ì´ ë¬¸ìœ¼ë¡œ ê°€ì•¼ í•©ë‹ˆë‹¤. ë­ë¼ê³  ì í˜€ìˆë‚˜ìš”?", answer: "EXIT", secretNumber: '0', solved: false }, 
                /* â–¼â–¼â–¼ [ì •ë‹µ í˜•ì‹ ìˆ˜ì •] â–¼â–¼â–¼ */
                '3': { question: "ë°© í•œê°€ìš´ë°ì— ìˆëŠ” í° ì‹ë¬¼ì€?", answer: ["ë‚˜ë¬´", "ì•¼ììˆ˜"], secretNumber: '3', solved: false } 
            }
        };
        const roomPasswords = { '1': '714', '2': '295', '3': '803' };
        const roomStates = { '1': { cleared: false }, '2': { cleared: false }, '3': { cleared: false } };
        let currentQuiz = {}, currentRoomForPassword = 0, elapsedSeconds = 0, timerInterval = null, collectedHints = {}, playerName = "";

        // --- í•¨ìˆ˜ ì •ì˜ ---
        function startTimer() { timerInterval = setInterval(() => { elapsedSeconds++; const minutes = Math.floor(elapsedSeconds / 60); const seconds = elapsedSeconds % 60; timerDisplayEl.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`; }, 1000); }
        function updateHintDisplay() { let displayText = "ìˆ˜ì§‘í•œ íŒíŠ¸: "; for (let i = 1; i <= 3; i++) { const hintValue = collectedHints[i] || '?'; displayText += `[${i}ë²ˆ: ${hintValue}] `; } hintDisplayEl.textContent = displayText.trim(); }
        function resetHints() { collectedHints = {}; updateHintDisplay(); }
        function updateStageDisplay(stageNumber) { stageDisplayEl.textContent = `ìŠ¤í…Œì´ì§€ ${stageNumber}`; }
        function checkRoomCompletion(roomNum) { if (roomStates[roomNum].cleared) { return; } const allSolved = Object.values(quizzes[roomNum]).every(quiz => quiz.solved); if (allSolved) { setTimeout(() => { currentRoomForPassword = roomNum; passwordTitleEl.textContent = `ì œ ${roomNum} ìŠ¤í…Œì´ì§€ ë¹„ë°€ë²ˆí˜¸`; passwordInputEl.value = ''; passwordResultEl.textContent = ''; passwordModal.style.display = 'flex'; passwordInputEl.focus(); }, 300); } }
        
        /* â–¼â–¼â–¼ [ë³µìˆ˜ ì •ë‹µ ì²˜ë¦¬ ë¡œì§] â–¼â–¼â–¼ */
        function checkQuizAnswer() {
            const puncAndSpaceRegex = /[\s.,!?]/g;
            const sanitizedUserAnswer = answerEl.value.replace(puncAndSpaceRegex, '').toLowerCase();
            
            if (!sanitizedUserAnswer) {
                quizResultEl.textContent = "ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”!";
                quizResultEl.style.color = 'orange';
                return;
            }

            const correctAnswerData = currentQuiz.answer;
            let isCorrect = false;

            // ì •ë‹µì´ ë°°ì—´ì¸ì§€ í™•ì¸
            if (Array.isArray(correctAnswerData)) {
                // ë°°ì—´ì´ë©´, ë°°ì—´ì˜ ìš”ì†Œ ì¤‘ í•˜ë‚˜ì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
                const sanitizedCorrectAnswerArray = correctAnswerData.map(ans => ans.replace(puncAndSpaceRegex, '').toLowerCase());
                isCorrect = sanitizedCorrectAnswerArray.includes(sanitizedUserAnswer);
            } else {
                // ë°°ì—´ì´ ì•„ë‹ˆë©´(ê¸°ì¡´ì²˜ëŸ¼ ë¬¸ìì—´ì´ë©´) ê·¸ëŒ€ë¡œ ë¹„êµ
                const sanitizedCorrectAnswer = correctAnswerData.replace(puncAndSpaceRegex, '').toLowerCase();
                isCorrect = (sanitizedUserAnswer === sanitizedCorrectAnswer);
            }
            
            // ì •ë‹µ/ì˜¤ë‹µ ê²°ê³¼ ì²˜ë¦¬
            if (isCorrect) {
                const hintIndex = currentQuiz.object;
                const secretValue = currentQuiz.secretNumber;
                const hintMessage = `${hintIndex}ë²ˆì§¸ ë²ˆí˜¸ëŠ” [${secretValue}] ì…ë‹ˆë‹¤!`;
                quizResultEl.innerHTML = `ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰<br>${hintMessage}`;
                quizResultEl.style.color = 'green';
                if (!collectedHints[hintIndex]) {
                    collectedHints[hintIndex] = secretValue;
                    updateHintDisplay();
                }
                if (!quizzes[currentQuiz.room][currentQuiz.object].solved) {
                    quizzes[currentQuiz.room][currentQuiz.object].solved = true;
                }
            } else {
                // ì˜¤ë‹µì¼ ë•Œ ëŒ€í‘œ ì •ë‹µ í•˜ë‚˜ë§Œ ë³´ì—¬ì¤Œ (ë°°ì—´ì¸ ê²½ìš° ì²« ë²ˆì§¸ ê°’)
                const displayAnswer = Array.isArray(correctAnswerData) ? correctAnswerData[0] : correctAnswerData;
                quizResultEl.textContent = `í‹€ë ¸ì–´ìš”! ì •ë‹µì€ '${displayAnswer}'ì…ë‹ˆë‹¤.`;
                quizResultEl.style.color = 'red';
            }
        }

        function checkRoomPassword() { const userInput = passwordInputEl.value.trim(); if (userInput === roomPasswords[currentRoomForPassword]) { roomStates[currentRoomForPassword].cleared = true; passwordModal.style.display = 'none'; if (currentRoomForPassword < 3) { doorOpenModal.style.display = 'flex'; } setTimeout(() => { if (doorOpenModal.style.display === 'flex') { doorOpenModal.style.display = 'none'; } if (currentRoomForPassword == 3) { clearInterval(timerInterval); const escapeCount = Number(localStorage.getItem('escapeCount')) || 0; const newEscapeCount = escapeCount + 1; escapeRankEl.textContent = `ë‹¹ì‹ ì€ ${newEscapeCount}ë²ˆì§¸ ì•ˆì „ ì „ë¬¸ê°€ì…ë‹ˆë‹¤!`; localStorage.setItem('escapeCount', newEscapeCount); playerNameDisplayEl.textContent = playerName; finalTimeEl.textContent = `ì†Œìš” ì‹œê°„: ${timerDisplayEl.textContent}`; gameClearModal.style.display = 'flex'; } else { const nextStage = Number(currentRoomForPassword) + 1; const currentRoomEl = document.getElementById(`room${currentRoomForPassword}`); const nextRoomEl = document.getElementById(`room${nextStage}`); currentRoomEl.classList.remove('active'); nextRoomEl.classList.add('active'); resetHints(); updateStageDisplay(nextStage); } }, 1500); } else { passwordResultEl.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.'; passwordResultEl.style.color = 'red'; } }

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë° ì´ˆê¸°í™” ---
        clickableObjects.forEach(obj => { obj.addEventListener('click', () => { const room = obj.dataset.room; const object = obj.dataset.object; currentQuiz = quizzes[room][object]; currentQuiz.room = room; currentQuiz.object = object; questionEl.textContent = currentQuiz.question; quizResultEl.textContent = ''; answerEl.value = ''; quizModal.style.display = 'flex'; answerEl.focus(); }); });
        submitAnswerBtn.addEventListener('click', checkQuizAnswer);
        answerEl.addEventListener('keyup', e => { if (e.key === 'Enter') checkQuizAnswer(); });
        closeQuizBtn.addEventListener('click', () => { quizModal.style.display = 'none'; if (currentQuiz.room) { checkRoomCompletion(currentQuiz.room); } });
        submitPasswordBtn.addEventListener('click', checkRoomPassword);
        passwordInputEl.addEventListener('keyup', e => { if (e.key === 'Enter') checkRoomPassword(); });
        restartGameBtn.addEventListener('click', () => { location.reload(); });
        showNameInputBtn.addEventListener('click', () => { titleScreenModal.style.display = 'none'; nameInputModal.style.display = 'flex'; playerNameInputEl.focus(); });
        function handleSubmitName() { playerName = playerNameInputEl.value.trim(); if (!playerName) { alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; } nameInputModal.style.display = 'none'; welcomeMessageTextEl.textContent = `${playerName}ë‹˜, ì €ì™€ í•¨ê»˜ ì•ˆì „ ìˆ˜ì¹™ì„ ë°°ì›Œë´ìš”! âœ¨`; welcomeMessageModal.style.display = 'flex'; }
        submitNameBtn.addEventListener('click', handleSubmitName);
        playerNameInputEl.addEventListener('keyup', (e) => { if (e.key === 'Enter') handleSubmitName(); });
        function handleGameStart() { welcomeMessageModal.style.display = 'none'; timerDisplayEl.style.display = 'block'; hintDisplayEl.style.display = 'block'; stageDisplayEl.style.display = 'block'; startTimer(); updateHintDisplay(); updateStageDisplay(1); }
        startGameBtn.addEventListener('click', handleGameStart);
    </script>
</body>
</html>